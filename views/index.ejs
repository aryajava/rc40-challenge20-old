<%- include('layout') %>
<div class="">
  <h1>BREAD Application</h1>
</div>
<div class="">
  <form id="searchForm" action="/" method="get">
    <label for="name">Name:</label>
    <input type="text" id="name" name="name" value="<%= searchParams.name || '' %>" />
    
    <label for="height">Height:</label>
    <input type="number" id="height" name="height" value="<%= searchParams.height || '' %>" />
    
    <label for="weight">Weight:</label>
    <input
    type="number"
    step="0.01"
    id="weight"
    name="weight"
    value="<%= searchParams.weight || '' %>"
    />
    
    <label for="startdate">Start Date:</label>
    <input type="date" id="startdate" name="startdate" value="<%= searchParams.startdate || '' %>" />
    
    <label for="lastdate">Last Date:</label>
    <input type="date" id="lastdate" name="lastdate" value="<%= searchParams.lastdate || '' %>" />
    
    <label for="married">Is Married:</label>
    <select id="married" name="married">
      <option value="">--Select--</option>
      <option value="Not Yet" <%= searchParams.married === 'Not Yet' ? 'selected' : '' %>>Not Yet</option>
      <option value="Yes" <%= searchParams.married === 'Yes' ? 'selected' : '' %>>Yes</option>
    </select>
    
    <label for="operation">Operation:</label>
    <input type="radio" name="operation" value="AND" <%= searchParams.operation === 'AND' ? 'checked' : '' %>> AND
    <input type="radio" name="operation" value="OR" <%= searchParams.operation === 'OR' ? 'checked' : '' %>> OR
    
    <button type="submit">Search</button>
    <a href="/">Reset </a>
  </form> 
</div>

<div class="">
  <a href="/add">Add New Record</a>
</div>

<div id="data-container">
  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Height</th>
        <th>Weight</th>
        <th>Birthdate</th>
        <th>Married</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="data-tbody">
      <% data.forEach(row => { %>
      <tr>
        <td><%= row.id %></td>
        <td><%= row.name %></td>
        <td><%= row.height %></td>
        <td><%= row.weight %></td>
        <td><%= row.birthdate %></td>
        <td><%= row.married ? 'Yes' : 'No' %></td>
        <td>
          <form action="/edit/<%= row.id %>" method="get">
            <button type="submit">Edit</button>
          </form>
          <form action="/delete/<%= row.id %>" method="post">
            <button type="submit">Delete</button>
          </form>
        </td>
      </tr>
      <% }) %>
    </tbody>
  </table>
</div>
<div id="pagination-controls">
  <% if (currentPage > 1) { %>
    <a href="/?page=<%= currentPage - 1 %>&name=<%= searchParams.name || '' %>&height=<%= searchParams.height || '' %>&weight=<%= searchParams.weight || '' %>&startdate=<%= searchParams.startdate || '' %>&lastdate=<%= searchParams.lastdate || '' %>&married=<%= searchParams.married || '' %>&operation=<%= searchParams.operation || '' %>">Previous</a>
  <% } %>
  
  <% for (let i = 1; i <= Math.ceil(totalItems / 5); i++) { %>
    <a href="/?page=<%= i %>&name=<%= searchParams.name || '' %>&height=<%= searchParams.height || '' %>&weight=<%= searchParams.weight || '' %>&startdate=<%= searchParams.startdate || '' %>&lastdate=<%= searchParams.lastdate || '' %>&married=<%= searchParams.married || '' %>&operation=<%= searchParams.operation || '' %>" class="<%= i === currentPage ? 'active' : '' %>"><%= i %></a>
  <% } %>
  
  <% if (currentPage < Math.ceil(totalItems / 5)) { %>
    <a href="/?page=<%= currentPage + 1 %>&name=<%= searchParams.name || '' %>&height=<%= searchParams.height || '' %>&weight=<%= searchParams.weight || '' %>&startdate=<%= searchParams.startdate || '' %>&lastdate=<%= searchParams.lastdate || '' %>&married=<%= searchParams.married || '' %>&operation=<%= searchParams.operation || '' %>">Next</a>
  <% } %>
</div>

<script type="module">
  import { setupPagination, renderPage } from '/js/pagination.js';
  const totalItems = parseInt(`<%= totalItems %>`);
  const currentPage = parseInt(`<%= currentPage %>`);
  setupPagination(totalItems);
  renderPage(currentPage);
</script>